<!-- Load ENGrid's Javascript Asynchronous -->
<script async src="../engrid.js"></script>

<!-- Start Render Critical Javascript -->
<script>
  window.addEventListener("DOMContentLoaded", (event) => {
    // Move this DOM elements before the page renders
    let inlineMonthlyUpsell = document.querySelectorAll(
      ".move-after-transaction-recurrfreq"
    )[0];
    let recurrFrequencyField = document.querySelectorAll(
      ".en__field--recurrfreq"
    )[0];
    if (inlineMonthlyUpsell && recurrFrequencyField) {
      recurrFrequencyField.insertAdjacentElement(
        "beforeend",
        inlineMonthlyUpsell
      );
    }

    // Move this DOM elements before the page renders
    let inlineDonationAmountHeader = document.querySelectorAll(
      ".move-before-transaction-donationamt"
    )[0];
    let donationAmtField = document.querySelectorAll(
      ".en__field--donationAmt"
    )[0];
    if (inlineDonationAmountHeader && donationAmtField) {
      donationAmtField.insertAdjacentElement(
        "afterbegin",
        inlineDonationAmountHeader
      );
    }

    // 4Site's simplified image lazy loader
    var srcDefer = document.querySelectorAll("img[data-src]");
    for (var i = 0; i < srcDefer.length; i++) {
      let dataSrc = srcDefer[i].getAttribute("data-src");
      if (dataSrc) {
        srcDefer[i].setAttribute("decoding", "async"); // Gets image processing off the main working thread
        srcDefer[i].setAttribute("loading", "lazy"); // Lets the browser determine when the asset should be downloaded
        srcDefer[i].setAttribute("src", dataSrc); // Sets the src which will cause the browser to retrieve the asset
        srcDefer[i].setAttribute("data-engrid-data-src-processed", "true"); // Sets an attribute to mark that it has been processed by ENGrid
        srcDefer[i].removeAttribute("data-src"); // Removes the data-source
      }
    }
  });
</script>
<!-- End Render Critical Javascript -->

<!-- Temporary Styles During QA -->
<style>
  /* Correct the sizing of the H2 Header that is moved inside a form component with JS before page render */
  [data-engrid-theme="{{theme}}"] .en__field--donationAmt h2 {
    margin-left: 0.5rem;
    margin-right: 0;
    width: calc(100% - 1rem);
  }
</style>
